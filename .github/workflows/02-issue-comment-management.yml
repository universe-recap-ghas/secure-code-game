name: 02 - Issue and Comment Management

on:
  workflow_dispatch:

permissions:
  contents: write
  issues: write

jobs:
  manage-issue-and-comment:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Create Issue
        id: create-issue
        uses: tdupoiron-actions/create-issue-action@main
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          repository: ${{ github.repository }}
          title: 'ðŸŽ‰ GitHub Universe Recap - Paris 2025'
          body: |
            ## GitHub Universe Recap - Paris Edition
            
            ðŸ“… **Date:** November 25, 2025
            ðŸ“ **Location:** Paris, France
            
            ### Event Highlights
            
            Join us for an exclusive recap of GitHub Universe 2025! This special event brings together developers, security professionals, and GitHub enthusiasts from across France and Europe.
            
            **What to expect:**
            - ðŸš€ Latest GitHub innovations and product announcements
            - ðŸ”’ Advanced security features with GitHub Advanced Security
            - ðŸ¤– AI-powered development with GitHub Copilot
            - ðŸ’¡ Best practices from industry leaders
            - ðŸŒŸ Networking with the French developer community
            
            ### Agenda
            - **09:00** - Registration & Coffee
            - **10:00** - Keynote: The Future of AI-Assisted Development
            - **11:30** - Workshop: Secure Code Game Challenge
            - **14:00** - GitHub Advanced Security Deep Dive
            - **16:00** - Community Networking
            
            Looking forward to seeing everyone there! ðŸ‡«ï¿½ï¿½
            
            ---
            _This issue was automatically created to track the GitHub Universe Recap Paris event._
      
      - name: Add Comment to Commit
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.PAT_TOKEN }}
          repository: ${{ github.repository }}
          issue-number: ${{ steps.create-issue.outputs.issue-number }}
          body: |
            ðŸŽ¯ **GitHub Universe Recap Paris - Automated Workflow**
            
            This commit is part of the GitHub Universe Recap event demonstration in Paris (November 25, 2025).
            
            âœ¨ Demonstrating GitHub Actions automation:
            - âœ… Issue creation
            - ðŸ’¬ Commit commenting
            - ðŸ”’ Automated issue closure
            
            ðŸ‡«ðŸ‡· Merci et Ã  bientÃ´t Ã  Paris!
      
      - name: Close Issue with Octokit
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            const issueNumber = ${{ steps.create-issue.outputs.issue-number }};
            
            await github.rest.issues.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              state: 'closed',
              state_reason: 'completed'
            });
            
            console.log(`âœ… Successfully closed issue #${issueNumber}`);
      
      - name: Summary
        run: |
          echo "## ðŸŽ‰ GitHub Universe Recap Paris 2025 - Workflow Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **Issue Created:** #${{ steps.create-issue.outputs.issue-number }}" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“ **Issue URL:** ${{ steps.create-issue.outputs.issue-url }}" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¬ **Comment added to commit:** \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”’ **Issue Closed:** #${{ steps.create-issue.outputs.issue-number }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ‡«ðŸ‡· **Event:** GitHub Universe Recap - Paris, November 25, 2025" >> $GITHUB_STEP_SUMMARY
